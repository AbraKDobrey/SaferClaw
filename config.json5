// ~/.openclaw/config.json5
// OpenClaw Autonomous Bot Configuration (SaferClaw)
// ==================================================
//
// INSTRUCTIONS:
// 1. Copy this file to ~/.openclaw/config.json5
// 2. Replace the placeholder Telegram user ID (0) with your real Telegram user ID
//    (find yours via @userinfobot in Telegram)
// 3. Replace YOUR_DOMAIN with your domain (e.g.: myopenclaw.duckdns.org)
//    OR leave webhook commented out to use long-polling (works without a domain)
// 4. Verify all tokens are set in .env.openclaw
//
{
  // ===== META =====
  meta: {
    lastTouchedVersion: "current",
    lastTouchedAt: "2026-02-05",
  },

  // ===== LOGGING =====
  logging: {
    level: "info",
    consoleLevel: "info",
    redactSensitive: "tools",
    file: "/var/log/openclaw/openclaw.log"
  },

  // ===== SESSION ISOLATION =====
  session: {
    dmScope: "per-channel-peer"
  },

  // ===== DISCOVERY - OFF =====
  discovery: {
    mdns: {
      mode: "off"  // CRITICAL: no LAN discovery
    }
  },

  // ===== DIAGNOSTICS - OFF =====
  diagnostics: {
    otel: {
      enabled: false
    }
  },

  // ===== GATEWAY =====
  gateway: {
    port: 47832,
    bind: "loopback",

    auth: {
      mode: "token",  // Token via env: OPENCLAW_GATEWAY_TOKEN
    },

    controlUi: {
      enabled: false
    },

    trustedProxies: ["127.0.0.1"],

    http: {
      endpoints: {
        chatCompletions: { enabled: false },
        responses: { enabled: false }
      }
    },

    nodes: {
      denyCommands: ["*"]
    },

    tailscale: { mode: "off" },
    reload: { mode: "off" }
  },

  // ===== TOOLS - AUTONOMOUS =====
  tools: {
    profile: "full",

    deny: [
      "gateway",
      "nodes"
    ],

    elevated: {
      enabled: false
    },

    exec: {
      security: "full",
      ask: "off",
      timeoutSec: 600,
      backgroundMs: 30000,
      cleanupMs: 300000,
      notifyOnExit: true,
      applyPatch: {
        enabled: true
      }
    },

    sandbox: {
      tools: {
        deny: ["gateway", "nodes"]
      }
    },

    subagents: {
      tools: {
        deny: ["gateway", "nodes"]
      }
    },

    message: {
      allowCrossContextSend: true,
      crossContext: {
        allowWithinProvider: true,
        allowAcrossProviders: false
      },
      broadcast: {
        enabled: true
      }
    },

    agentToAgent: {
      enabled: true
    },

    web: {
      search: {
        enabled: true,
        maxResults: 20,
        timeoutSeconds: 30
      },
      fetch: {
        enabled: true,
        maxChars: 100000,
        timeoutSeconds: 60,
        maxRedirects: 5
      }
    }
  },

  // ===== AGENTS - NATIVE (NO DOCKER) =====
  agents: {
    defaults: {
      // Default model - via OpenRouter
      model: { primary: "openrouter/x-ai/grok-4.1-fast" },

      sandbox: {
        mode: "off",  // No Docker - tools run directly on host

        browser: {
          enabled: false
        }
      },

      elevatedDefault: "off",
      timeoutSeconds: 1800,
      maxConcurrent: 3,
      contextTokens: 150000,

      subagents: {
        maxConcurrent: 5,
        archiveAfterMinutes: 120
      },
    }
  },

  // ===== TELEGRAM CHANNEL =====
  channels: {
    telegram: {
      enabled: true,
      // botToken via env: TELEGRAM_BOT_TOKEN

      dmPolicy: "allowlist",
      allowFrom: [
        // REPLACE with your Telegram user ID (find via @userinfobot in Telegram)
        0
      ],

      groupPolicy: "disabled",
      configWrites: true,
      streamMode: "partial",

      actions: {
        reactions: true,
        sendMessage: true,
        deleteMessage: true,
        sticker: false
      },

      reactionLevel: "ack",
      historyLimit: 100,
      dmHistoryLimit: 200,
      textChunkLimit: 4000,

      // ---------------------------------------------------------------
      // WEBHOOK CONFIG (optional)
      // Uncomment AFTER you have SSL set up via setup-ssl.sh.
      // Without these lines, Telegram uses long-polling (works fine).
      // ---------------------------------------------------------------
      // webhookUrl: "https://YOUR_DOMAIN/tg/webhook",
      // webhookPath: "/tg/webhook",
      // webhookSecret via env: TELEGRAM_WEBHOOK_SECRET
    },

    defaults: {
      groupPolicy: "disabled"
    }
  },

  // ===== SKILLS =====
  skills: {
    allowBundled: [
      "cursor-cli",      // PRIMARY coding tool - Cursor CLI agents
      "coding-agent",    // Fallback: Codex/Claude Code/Pi
      "tmux",
      "summarize",
      "github",
      "weather",
      "session-logs",
      "openai-whisper",
      "openai-whisper-api",
      "canvas",
      "oracle",
      "healthcheck",
      "himalaya"
    ],

    load: {
      watch: false,
      extraDirs: []
    },

    entries: {
      "skill-creator": { enabled: false },
      "clawhub": { enabled: false },
      "mcporter": { enabled: false },
      "camsnap": { enabled: false }
    }
  },

  // ===== HOOKS =====
  // token is loaded from HOOKS_TOKEN env var by the gateway
  // If you get "hooks.enabled requires hooks.token", add your token here:
  //   hooks: { enabled: true, token: "YOUR_HOOKS_TOKEN_HERE", ... }
  hooks: {
    enabled: false,
    path: "/hooks",
    maxBodyBytes: 2097152
  },

  // ===== CRON =====
  cron: {
    enabled: true,
  },

  // ===== APPROVALS - OFF =====
  approvals: {
    exec: {
      enabled: false
    }
  },

  // ===== BROWSER - OFF =====
  browser: {
    enabled: false
  },

  // ===== PLUGINS =====
  // IMPORTANT: Must be enabled for Telegram to work (Telegram is a plugin)
  plugins: {
    enabled: true,
    entries: {
      telegram: { enabled: true }
    }
  }
}
